<div class="article_index_frame" id="article_index_frame_div">
  <div class="article_index_body" id="article_index_body_div">
    <div class="articleIndexHeaderFrame">
      <h2 class="articleIndexTitle">Explore Blessed Astra</h2>
      <h3 class="articleIndexExplanation">Click a tile to read</h3>
    </div>
    <table class="article_index_table" id="article_index_table">
    </table>
  </div>
</div>

<script type="text/javascript">
  let xhr = new XMLHttpRequest();
  xhr.open('GET', '/static/json/articles.json');
  xhr.send(null);

  xhr.onreadystatechange = function () {
    let DONE = 4; // readyState 4 means the request is done.
    let OK = 200; // status 200 is a successful return.

    let cellsPerRow = 3;
    let cellIdx = 1;
    let rowNumber = 1;
    let table = document.getElementById("article_index_table");
    let tr = document.createElement("tr");
    tr.classList.add("article_index");

    if (xhr.readyState === DONE) {
      if (xhr.status === OK) {
        console.log(xhr.responseText); // 'This is the returned text.'

        let jsonObj = JSON.parse(xhr.responseText);
        let parsedJsonObj = parseJSON(jsonObj);
        sortArticlesByDate(parsedJsonObj["article"]);

        //alert(parsedJsonObj["article"]);
        for (let i=0; i<parsedJsonObj["article"].length; i++) {
          let c = String(i+1);
          let title = parsedJsonObj["article"][i].fields.title;
          let urlstring = parsedJsonObj["article"][i].fields.url_string;
          let pubdate = parsedJsonObj["article"][i].fields.pub_date;

          let imgPath = `/static/articles/img/${urlstring}.jpg`;
          let aPath = `/articles/${urlstring}`;

          let td = document.createElement("td");
          let a = document.createElement("a");
          let p = document.createElement("p");
          let p2 = document.createElement("p");
          let text = document.createTextNode(title);
          let text2 = document.createTextNode("Click to Read");
          a.setAttribute('href', aPath);

          td.classList.add("article_index_td");
          assignTDStyle(td, imgPath, urlstring, p, p2, text, text2);
          assignTDEvents(td, imgPath, urlstring, p, p2, text, text2);

          tr.appendChild(td);

          if (cellIdx % cellsPerRow == 0) {
              table.appendChild(tr);
              tr = document.createElement("tr");
          }
          cellIdx += 1;

        }
        table.appendChild(tr);


        //alert(xhr.responseText);

      } else {
        console.log('Error: ' + xhr.status); // An error occurred during the request.
      }
    }
  };
</script>
